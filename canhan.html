<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>M√¥ ph·ªèng ATTT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #050816;
      --bg-card: #0f172a;
      --bg-card-alt: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.15);
      --accent-2: #a855f7;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --border: #1f2937;
      --radius-xl: 18px;
      --radius-lg: 12px;
      --shadow-soft: 0 24px 60px rgba(15,23,42,0.8);
      --shadow-chip: 0 4px 18px rgba(15,23,42,0.9);
      --transition-fast: 0.15s ease-out;
      --transition-med: 0.25s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        Roboto, sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 60%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px 48px;
    }

    /* HEADER + NAV: lu√¥n x·∫øp theo c·ªôt, nav ngang full width */
    header {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin: 8px 0 24px;
      align-items: stretch;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 10% 0%, #38bdf8 0, transparent 45%),
        radial-gradient(circle at 90% 120%, #a855f7 0, transparent 45%),
        linear-gradient(135deg, #020617, #0b1120);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-chip);
      position: relative;
      overflow: hidden;
    }

    .brand-logo::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.25);
    }

    .brand-logo span {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 1px;
      color: #e5e7eb;
    }

    .brand-text h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.03em;
    }

    .brand-text p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.35);
      background: radial-gradient(circle at top, rgba(56,189,248,0.18), transparent 55%);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* NAV thanh ngang */
    nav {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      justify-content: flex-start;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      padding: 6px 12px;
      font-size: 12px;
      background: rgba(15,23,42,0.9);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: border-color var(--transition-fast),
                  background var(--transition-fast),
                  transform var(--transition-fast),
                  box-shadow var(--transition-fast),
                  color var(--transition-fast),
                  opacity var(--transition-fast);
      opacity: 0.9;
    }

    .nav-btn:hover {
      border-color: var(--accent);
      color: var(--text);
      background: radial-gradient(circle at top, rgba(56,189,248,0.18), rgba(15,23,42,1));
      transform: translateY(-1px);
      box-shadow: 0 12px 25px rgba(15,23,42,0.8);
      opacity: 1;
    }

    /* NAV ACTIVE: khi cu·ªôn t·ªõi section t∆∞∆°ng ·ª©ng */
    .nav-btn.active {
      border-color: rgba(56,189,248,0.95);
      background: linear-gradient(135deg, #0ea5e9, #6366f1);
      color: #f9fafb;
      box-shadow: 0 14px 32px rgba(37,99,235,0.7);
      opacity: 1;
    }

    .nav-btn span.icon {
      font-size: 14px;
    }

    /* MAIN: 1 c·ªôt t·ª´ tr√™n xu·ªëng d∆∞·ªõi */
    main {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.06), rgba(15,23,42,1));
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: 16px 16px 18px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.1), transparent 60%);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-med);
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title {
      font-size: 16px;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title .emoji {
      font-size: 18px;
    }

    .card-subtitle {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--muted);
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-2);
      box-shadow: 0 0 8px rgba(168,85,247,0.8);
    }

    .card-body {
      margin-top: 12px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31,41,55,0.9);
      background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(2,6,23,1));
      padding: 12px 12px 13px;
    }

    .collapser-btn {
      width: 100%;
      text-align: left;
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(55,65,81,0.9);
      padding: 7px 10px;
      background: rgba(15,23,42,0.9);
      color: var(--muted);
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: border-color var(--transition-fast),
                  background var(--transition-fast),
                  color var(--transition-fast),
                  transform var(--transition-fast);
    }

    .collapser-btn span.label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .collapser-btn .step-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--muted);
    }

    .collapser-btn .chevron {
      font-size: 14px;
      opacity: 0.8;
    }

    .collapser-btn:hover {
      border-color: rgba(56,189,248,0.9);
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(2,6,23,1));
      color: var(--text);
      transform: translateY(-0.5px);
    }

    .section-content {
      margin-top: 10px;
      display: none;
      animation: fadeIn 0.2s ease-out;
    }

    .section-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .field {
      margin-bottom: 8px;
    }

    .field label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      margin-bottom: 4px;
      color: var(--muted);
    }

    .field small {
      color: var(--muted);
      font-size: 11px;
    }

    textarea,
    input[type="text"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 7px 9px;
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 13px;
      resize: vertical;
      min-height: 30px;
      outline: none;
      transition: border-color var(--transition-fast),
                  box-shadow var(--transition-fast),
                  background var(--transition-fast);
    }

    textarea:focus,
    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
      background: rgba(15,23,42,1);
    }

    textarea {
      min-height: 60px;
      max-height: 200px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    button.action-btn {
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      padding: 5px 10px;
      font-size: 12px;
      background: rgba(15,23,42,1);
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background var(--transition-fast),
                  border-color var(--transition-fast),
                  transform var(--transition-fast),
                  box-shadow var(--transition-fast);
    }

    button.action-btn.primary {
      border-color: rgba(56,189,248,0.85);
      background: linear-gradient(135deg, #0ea5e9, #6366f1);
      box-shadow: 0 12px 30px rgba(37,99,235,0.4);
    }

    button.action-btn.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(37,99,235,0.6);
    }

    button.action-btn.secondary {
      border-color: rgba(148,163,184,0.7);
    }

    button.action-btn.secondary:hover {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(2,6,23,1));
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(15,23,42,0.9);
    }

    button.action-btn.danger {
      border-color: rgba(248,113,113,0.8);
      background: linear-gradient(135deg, #dc2626, #f97316);
      box-shadow: 0 12px 30px rgba(248,113,113,0.5);
    }

    .output {
      margin-top: 4px;
      font-family: "JetBrains Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      border-radius: 10px;
      padding: 7px 8px;
      background: radial-gradient(circle at top, rgba(15,23,42,1), rgba(2,6,23,1));
      border: 1px solid rgba(31,41,55,0.9);
      max-height: 150px;
      overflow: auto;
      word-break: break-all;
      white-space: pre-wrap;
    }

    .output-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .status {
      font-size: 11px;
      margin-top: 4px;
    }

    .status.ok {
      color: var(--success);
    }

    .status.error {
      color: var(--danger);
    }

    .tiny-note {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    /* Blockchain layout */
    .chain {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 200px;
      overflow-y: auto;
      margin-top: 6px;
    }

    .block {
      border-radius: 10px;
      padding: 6px 8px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.06), rgba(15,23,42,1));
      border: 1px solid rgba(31,41,55,0.9);
      font-family: "JetBrains Mono", ui-monospace;
      font-size: 11px;
    }

    .block.invalid {
      border-color: rgba(248,113,113,0.9);
      box-shadow: 0 0 0 1px rgba(248,113,113,0.4);
    }

    .block-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .block-index {
      font-weight: 600;
    }

    .chip {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.9);
      color: var(--muted);
    }

    footer {
      margin-top: 32px;
      border-top: 1px solid rgba(31,41,55,0.9);
      padding-top: 12px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="brand">
      <div class="brand-logo"><span>IS</span></div>
      <div class="brand-text">
        <h1>M√¥ ph·ªèng An to√†n th√¥ng tin</h1>
        <p>C√°c ch·ªß ƒë·ªÅ: h√†m bƒÉm, m√£ h√≥a ƒë·ªëi x·ª©ng/b·∫•t ƒë·ªëi x·ª©ng, ch·ªØ k√Ω s·ªë, ch·ª©ng th·ª±c, sinh tr·∫Øc h·ªçc, blockchain.</p>
      </div>
    </div>

    <!-- NAV: m·ªói n√∫t c√≥ id ƒë·ªÉ active -->
    <nav>
      <button class="nav-btn active" id="nav-hash" onclick="scrollToCard('hash-card')">
        <span class="icon">#</span> <span>H√†m bƒÉm</span>
      </button>
      <button class="nav-btn" id="nav-sym" onclick="scrollToCard('sym-card')">
        <span class="icon">üîê</span> <span>M√£ ƒë·ªëi x·ª©ng</span>
      </button>
      <button class="nav-btn" id="nav-asym" onclick="scrollToCard('asym-card')">
        <span class="icon">üß¨</span> <span>M√£ b·∫•t ƒë·ªëi x·ª©ng</span>
      </button>
      <button class="nav-btn" id="nav-sig" onclick="scrollToCard('sig-card')">
        <span class="icon">‚úçÔ∏è</span> <span>Ch·ªØ k√Ω s·ªë</span>
      </button>
      <button class="nav-btn" id="nav-auth" onclick="scrollToCard('auth-card')">
        <span class="icon">‚úÖ</span> <span>Ch·ª©ng th·ª±c & Sinh tr·∫Øc</span>
      </button>
      <button class="nav-btn" id="nav-bc" onclick="scrollToCard('bc-card')">
        <span class="icon">‚õìÔ∏è</span> <span>Blockchain</span>
      </button>
    </nav>
  </header>

  <main>
    <!-- 1. HASH -->
    <section class="card" id="hash-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">#Ô∏è‚É£</span> H√†m bƒÉm (Hash function)</h2>
          <p class="card-subtitle">Bi·∫øn d·ªØ li·ªáu ƒë·∫ßu v√†o th√†nh ‚Äúd·∫•u v√¢n tay‚Äù c·ªë ƒë·ªãnh, kh√≥ ƒë·∫£o ng∆∞·ª£c.</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> SHA-256 demo</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('hash-section')">
          <span class="label">
            <span class="step-dot">1</span>
            <span>B·∫•m ƒë·ªÉ nh·∫≠p d·ªØ li·ªáu v√† ch·∫°y h√†m bƒÉm</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="hash-section">
          <div class="field">
            <label for="hashInput">Chu·ªói c·∫ßn bƒÉm</label>
            <textarea id="hashInput" placeholder="V√≠ d·ª•: matkhau123, th√¥ng ƒëi·ªáp, JSON,..."></textarea>
          </div>
          <div class="btn-row">
            <button class="action-btn primary" onclick="hashMessage()">
              <span>üîÅ</span> <span>T√≠nh SHA-256 (X√°c nh·∫≠n & ch·∫°y)</span>
            </button>
            <button class="action-btn secondary" onclick="clearHash()">
              <span>üßπ</span> <span>X√≥a</span>
            </button>
          </div>
          <div>
            <div class="output-label">Gi√° tr·ªã bƒÉm (hex)</div>
            <div class="output" id="hashOutput">‚Äî Ch∆∞a c√≥ k·∫øt qu·∫£ ‚Äî</div>
          </div>
          <p class="tiny-note">
            H√†m bƒÉm m·ªôt chi·ªÅu: c√πng d·ªØ li·ªáu ‚Üí lu√¥n ra c√πng hash; thay ƒë·ªïi 1 k√Ω t·ª± ‚Üí hash kh√°c h·∫≥n.
            D√πng trong l∆∞u m·∫≠t kh·∫©u (k·∫øt h·ª£p mu·ªëi, l·∫∑p), ki·ªÉm tra to√†n v·∫πn d·ªØ li·ªáu, blockchain,...
          </p>
        </div>
      </div>
    </section>

    <!-- 2. SYMMETRIC -->
    <section class="card" id="sym-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">üîê</span> M√£ h√≥a ƒë·ªëi x·ª©ng (AES-GCM)</h2>
          <p class="card-subtitle">C√πng m·ªôt kh√≥a b√≠ m·∫≠t d√πng cho c·∫£ m√£ h√≥a v√† gi·∫£i m√£.</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> AES-256-GCM</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('sym-section')">
          <span class="label">
            <span class="step-dot">2</span>
            <span>Hi·ªÉn th·ªã c√°c b∆∞·ªõc: t·∫°o kh√≥a ‚Üí m√£ h√≥a ‚Üí gi·∫£i m√£</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="sym-section">
          <div class="field">
            <label for="symPlain">B·∫£n r√µ c·∫ßn m√£ h√≥a</label>
            <textarea id="symPlain" placeholder="Th√¥ng ƒëi·ªáp b√≠ m·∫≠t c·ªßa b·∫°n..."></textarea>
          </div>
          <div class="btn-row">
            <button class="action-btn primary" onclick="generateSymKey()">
              <span>üóùÔ∏è</span> <span>T·∫°o kh√≥a phi√™n (X√°c nh·∫≠n)</span>
            </button>
            <button class="action-btn secondary" onclick="encryptSym()">
              <span>üîí</span> <span>M√£ h√≥a v·ªõi AES-GCM</span>
            </button>
            <button class="action-btn secondary" onclick="decryptSym()">
              <span>üîì</span> <span>Gi·∫£i m√£</span>
            </button>
          </div>
          <div class="field">
            <label>Kh√≥a b√≠ m·∫≠t (base64, 256-bit)</label>
            <div class="output" id="symKey">‚Äî B·∫•m ‚ÄúT·∫°o kh√≥a phi√™n‚Äù ƒë·ªÉ sinh kh√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label>IV (nonce, base64)</label>
            <div class="output" id="symIv">‚Äî S·∫Ω sinh khi b·∫°n m√£ h√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label>B·∫£n m√£ (ciphertext, base64)</label>
            <div class="output" id="symCipher">‚Äî Ch∆∞a c√≥ b·∫£n m√£ ‚Äî</div>
          </div>
          <div class="field">
            <label>B·∫£n r√µ sau khi gi·∫£i m√£</label>
            <div class="output" id="symDecrypted">‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî</div>
          </div>
          <p class="tiny-note">
            M√£ ƒë·ªëi x·ª©ng nhanh, ph√π h·ª£p m√£ h√≥a nhi·ªÅu d·ªØ li·ªáu (ƒëƒ©a, k√™nh VPN...). V·∫•n ƒë·ªÅ l·ªõn l√†
            ph√¢n ph·ªëi kh√≥a b√≠ m·∫≠t an to√†n cho c√°c b√™n. Trong th·ª±c t·∫ø, n√≥ th∆∞·ªùng k·∫øt h·ª£p v·ªõi
            m√£ b·∫•t ƒë·ªëi x·ª©ng ƒë·ªÉ trao ƒë·ªïi kh√≥a.
          </p>
        </div>
      </div>
    </section>

    <!-- 3. ASYMMETRIC -->
    <section class="card" id="asym-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">üß¨</span> M√£ h√≥a b·∫•t ƒë·ªëi x·ª©ng (RSA-OAEP)</h2>
          <p class="card-subtitle">D√πng c·∫∑p kh√≥a: kh√≥a c√¥ng khai ƒë·ªÉ m√£, kh√≥a b√≠ m·∫≠t ƒë·ªÉ gi·∫£i.</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> RSA 2048-bit</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('asym-section')">
          <span class="label">
            <span class="step-dot">3</span>
            <span>T·∫°o c·∫∑p kh√≥a RSA ‚Üí m√£ h√≥a ‚Üí gi·∫£i m√£</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="asym-section">
          <div class="btn-row">
            <button class="action-btn primary" onclick="generateRsaKeys()">
              <span>üóùÔ∏è</span> <span>T·∫°o c·∫∑p kh√≥a RSA (X√°c nh·∫≠n)</span>
            </button>
          </div>
          <div class="field">
            <label>Kh√≥a c√¥ng khai (r√∫t g·ªçn, base64)</label>
            <div class="output" id="rsaPublic">‚Äî Ch∆∞a t·∫°o kh√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label>Kh√≥a b√≠ m·∫≠t (r√∫t g·ªçn, base64)</label>
            <div class="output" id="rsaPrivate">‚Äî Ch∆∞a t·∫°o kh√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label for="rsaPlain">Th√¥ng ƒëi·ªáp c·∫ßn m√£ h√≥a (ng·∫Øn)</label>
            <textarea id="rsaPlain" placeholder="RSA th∆∞·ªùng d√πng ƒë·ªÉ m√£ h√≥a kh√≥a ƒë·ªëi x·ª©ng, ·ªü ƒë√¢y m√£ h√≥a th√¥ng ƒëi·ªáp ng·∫Øn ƒë·ªÉ demo."></textarea>
          </div>
          <div class="btn-row">
            <button class="action-btn secondary" onclick="rsaEncrypt()">
              <span>üîí</span> <span>M√£ h√≥a b·∫±ng kh√≥a c√¥ng khai</span>
            </button>
            <button class="action-btn secondary" onclick="rsaDecrypt()">
              <span>üîì</span> <span>Gi·∫£i m√£ b·∫±ng kh√≥a b√≠ m·∫≠t</span>
            </button>
          </div>
          <div class="field">
            <label>B·∫£n m√£ (base64)</label>
            <div class="output" id="rsaCipher">‚Äî Ch∆∞a c√≥ b·∫£n m√£ ‚Äî</div>
          </div>
          <div class="field">
            <label>B·∫£n r√µ sau khi gi·∫£i m√£</label>
            <div class="output" id="rsaDecrypted">‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî</div>
          </div>
          <p class="tiny-note">
            M√£ b·∫•t ƒë·ªëi x·ª©ng gi·∫£i quy·∫øt b√†i to√°n ph√¢n ph·ªëi kh√≥a: b·∫°n c√¥ng b·ªë kh√≥a c√¥ng khai,
            gi·ªØ b√≠ m·∫≠t kh√≥a ri√™ng. B·∫•t k·ª≥ ai c≈©ng m√£ h√≥a ƒë∆∞·ª£c cho b·∫°n nh∆∞ng ch·ªâ b·∫°n gi·∫£i m√£ ƒë∆∞·ª£c.
            Nh∆∞·ª£c ƒëi·ªÉm l√† ch·∫≠m, n√™n th∆∞·ªùng ch·ªâ d√πng ƒë·ªÉ m√£ h√≥a kh√≥a phi√™n (sau ƒë√≥ d√πng AES ƒë·ªÉ m√£ h√≥a d·ªØ li·ªáu).
          </p>
        </div>
      </div>
    </section>

    <!-- 4. DIGITAL SIGNATURE -->
    <section class="card" id="sig-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">‚úçÔ∏è</span> Ch·ªØ k√Ω s·ªë (RSA-PSS)</h2>
          <p class="card-subtitle">ƒê·∫£m b·∫£o: x√°c th·ª±c ngu·ªìn g·ªëc, to√†n v·∫πn, ch·ªëng ch·ªëi b·ªè.</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> RSA-PSS / SHA-256</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('sig-section')">
          <span class="label">
            <span class="step-dot">4</span>
            <span>T·∫°o c·∫∑p kh√≥a k√Ω s·ªë ‚Üí k√Ω ‚Üí ki·ªÉm tra</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="sig-section">
          <div class="btn-row">
            <button class="action-btn primary" onclick="generateSignKeys()">
              <span>üóùÔ∏è</span> <span>T·∫°o c·∫∑p kh√≥a ch·ªØ k√Ω (X√°c nh·∫≠n)</span>
            </button>
          </div>
          <div class="field">
            <label>Kh√≥a c√¥ng khai (r√∫t g·ªçn, base64)</label>
            <div class="output" id="sigPublic">‚Äî Ch∆∞a t·∫°o kh√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label>Kh√≥a b√≠ m·∫≠t (r√∫t g·ªçn, base64)</label>
            <div class="output" id="sigPrivate">‚Äî Ch∆∞a t·∫°o kh√≥a ‚Äî</div>
          </div>
          <div class="field">
            <label for="sigInput">Th√¥ng ƒëi·ªáp c·∫ßn k√Ω</label>
            <textarea id="sigInput" placeholder="V√≠ d·ª•: N·ªôi dung h·ª£p ƒë·ªìng, h√≥a ƒë∆°n ƒëi·ªán t·ª≠, th√¥ng ƒëi·ªáp giao d·ªãch..."></textarea>
          </div>
          <div class="btn-row">
            <button class="action-btn secondary" onclick="signMessage()">
              <span>‚úíÔ∏è</span> <span>T·∫°o ch·ªØ k√Ω s·ªë</span>
            </button>
            <button class="action-btn secondary" onclick="verifySignature()">
              <span>üßê</span> <span>Ki·ªÉm tra ch·ªØ k√Ω</span>
            </button>
          </div>
          <div class="field">
            <label>Ch·ªØ k√Ω s·ªë (base64)</label>
            <div class="output" id="sigOutput">‚Äî Ch∆∞a c√≥ ch·ªØ k√Ω ‚Äî</div>
          </div>
          <div class="status" id="sigStatus">‚Äî Ch∆∞a ki·ªÉm tra ‚Äî</div>
          <p class="tiny-note">
            Ch·ªØ k√Ω s·ªë ho·∫°t ƒë·ªông (t√≥m t·∫Øt): bƒÉm th√¥ng ƒëi·ªáp ‚Üí d√πng kh√≥a b√≠ m·∫≠t ƒë·ªÉ k√Ω ‚Üí b√™n nh·∫≠n d√πng
            kh√≥a c√¥ng khai ƒë·ªÉ ki·ªÉm tra. N·∫øu n·ªôi dung thay ƒë·ªïi ho·∫∑c d√πng sai kh√≥a c√¥ng khai th√¨ ki·ªÉm tra s·∫Ω th·∫•t b·∫°i.
          </p>
        </div>
      </div>
    </section>

    <!-- 5. AUTH + BIOMETRICS -->
    <section class="card" id="auth-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">‚úÖ</span> Ch·ª©ng th·ª±c & Sinh tr·∫Øc h·ªçc</h2>
          <p class="card-subtitle">Minh h·ªça x√°c th·ª±c ƒëa y·∫øu t·ªë: m·∫≠t kh·∫©u + OTP + sinh tr·∫Øc (gi·∫£ l·∫≠p).</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> Authentication</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('auth-section')">
          <span class="label">
            <span class="step-dot">5</span>
            <span>M·ªü m√¥ ph·ªèng ƒëƒÉng nh·∫≠p an to√†n</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="auth-section">
          <div class="field">
            <label for="authUser">T√†i kho·∫£n (gi·∫£ l·∫≠p)</label>
            <input id="authUser" type="text" placeholder="vd: student01">
          </div>
          <div class="field">
            <label for="authPass">M·∫≠t kh·∫©u</label>
            <input id="authPass" type="text" placeholder="m·∫≠t kh·∫©u demo l√†: 123456">
            <small>M·∫≠t kh·∫©u th·∫≠t ph·∫£i ƒë·ªß m·∫°nh, kh√¥ng n√™n gi·ªëng v√≠ d·ª• n√†y üòâ</small>
          </div>
          <div class="field">
            <label for="authOtp">M√£ OTP</label>
            <input id="authOtp" type="text" placeholder="m√£ OTP demo l√†: 000999">
            <small>Y·∫øu t·ªë ‚Äúnh·ªØng g√¨ b·∫°n c√≥‚Äù (·ª©ng d·ª•ng OTP, SMS, token...).</small>
          </div>
          <div class="field">
            <label>Sinh tr·∫Øc (gi·∫£ l·∫≠p): <span style="color:var(--muted)">nh·ªØng g√¨ v·ªën c√≥ (v√¢n tay, khu√¥n m·∫∑t...)</span></label>
            <div class="btn-row">
              <button class="action-btn secondary" onclick="fakeBiometric('finger')">
                <span>‚òùÔ∏è</span> <span>Qu√©t v√¢n tay (demo)</span>
              </button>
              <button class="action-btn secondary" onclick="fakeBiometric('face')">
                <span>üôÇ</span> <span>Nh·∫≠n di·ªán khu√¥n m·∫∑t (demo)</span>
              </button>
            </div>
          </div>
          <div class="btn-row">
            <button class="action-btn primary" onclick="attemptLogin()">
              <span>üö™</span> <span>ƒêƒÉng nh·∫≠p (ki·ªÉm tra c√°c y·∫øu t·ªë)</span>
            </button>
            <button class="action-btn secondary" onclick="resetAuth()">
              <span>üßπ</span> <span>Reset</span>
            </button>
          </div>
          <div class="status" id="authStatus">‚Äî Ch∆∞a ƒëƒÉng nh·∫≠p ‚Äî</div>
          <p class="tiny-note">
            X√°c th·ª±c c√≥ th·ªÉ d·ª±a tr√™n:
            <br>‚Ä¢ <b>Nh·ªØng g√¨ b·∫°n bi·∫øt</b>: m·∫≠t kh·∫©u, PIN.
            <br>‚Ä¢ <b>Nh·ªØng g√¨ b·∫°n c√≥</b>: ƒëi·ªán tho·∫°i nh·∫≠n OTP, token ph·∫ßn c·ª©ng.
            <br>‚Ä¢ <b>Nh·ªØng g√¨ v·ªën c√≥</b>: sinh tr·∫Øc h·ªçc (v√¢n tay, gi·ªçng n√≥i, khu√¥n m·∫∑t, v√µng m·∫°c...).
            <br>ƒêa y·∫øu t·ªë (2FA/MFA) an to√†n h∆°n nhi·ªÅu so v·ªõi ch·ªâ d√πng 1 y·∫øu t·ªë.
          </p>
        </div>
      </div>
    </section>

    <!-- 6. BLOCKCHAIN -->
    <section class="card" id="bc-card">
      <div class="card-header">
        <div>
          <h2 class="card-title"><span class="emoji">‚õìÔ∏è</span> Blockchain mini-demo</h2>
          <p class="card-subtitle">Chu·ªói kh·ªëi ƒë∆°n gi·∫£n: m·ªói block ch·ª©a hash c·ªßa block tr∆∞·ªõc.</p>
        </div>
        <span class="badge"><span class="badge-dot"></span> Hash-linked chain</span>
      </div>
      <div class="card-body">
        <button class="collapser-btn" onclick="toggleSection('bc-section')">
          <span class="label">
            <span class="step-dot">6</span>
            <span>Th√™m block & th·ª≠ ‚Äúgi·∫£ m·∫°o‚Äù d·ªØ li·ªáu</span>
          </span>
          <span class="chevron">‚ñº</span>
        </button>
        <div class="section-content" id="bc-section">
          <div class="field">
            <label for="blockData">D·ªØ li·ªáu block m·ªõi</label>
            <textarea id="blockData" placeholder="vd: Giao d·ªãch 1 g·ª≠i 5 coin cho 2... (ƒë·ªÉ tr·ªëng s·∫Ω sinh text demo)"></textarea>
          </div>
          <div class="btn-row">
            <button class="action-btn primary" onclick="addBlock()">
              <span>‚ûï</span> <span>Th√™m block v√†o chain</span>
            </button>
            <button class="action-btn secondary" onclick="tamperBlock()">
              <span>‚ö†Ô∏è</span> <span>Gi·∫£ m·∫°o d·ªØ li·ªáu block #1</span>
            </button>
            <button class="action-btn secondary" onclick="resetChain()">
              <span>üßπ</span> <span>X√≥a & t·∫°o l·∫°i blockchain</span>
            </button>
          </div>
          <div class="chain" id="chainView">
            <!-- Blocks s·∫Ω render ·ªü ƒë√¢y -->
          </div>
          <p class="tiny-note">
            M·ªói block ch·ª©a: index, th·ªùi gian, d·ªØ li·ªáu, <code>prevHash</code> v√† <code>hash</code>.
            N·∫øu c·ªë s·ª≠a d·ªØ li·ªáu m·ªôt block, hash c·ªßa block ƒë√≥ s·∫Ω ƒë·ªïi ‚Üí kh√¥ng c√≤n kh·ªõp v·ªõi
            <code>prevHash</code> c·ªßa block ph√≠a sau, chu·ªói b·ªã ‚Äúg√£y‚Äù. Th·ª±c t·∫ø blockchain
            c√≤n c√≥ ƒë·ªìng thu·∫≠n, ch·ªØ k√Ω s·ªë, PoW/PoS... ph·ª©c t·∫°p h∆°n nhi·ªÅu.
          </p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    23728961 - Tr·∫ßn Duy Khang
</footer>
</div>

<script>
  /* ====== UTILITIES ====== */
  function scrollToCard(id) {
    const el = document.getElementById(id);
    if (!el) return;
    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
    setActiveNav(id); // set active ngay khi click
  }

  function toggleSection(id) {
    const section = document.getElementById(id);
    if (!section) return;
    section.classList.toggle('active');
  }

  function bufferToHex(buffer) {
    const bytes = new Uint8Array(buffer);
    let hex = '';
    for (let b of bytes) {
      hex += b.toString(16).padStart(2, '0');
    }
    return hex;
  }

  function bufferToBase64(buffer) {
    const bytes = new Uint8Array(buffer);
    let binary = '';
    for (let i = 0; i < bytes.length; i++) {
      binary += String.fromCharCode(bytes[i]);
    }
    return btoa(binary);
  }

  function base64ToBuffer(base64) {
    const binary = atob(base64);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) {
      bytes[i] = binary.charCodeAt(i);
    }
    return bytes.buffer;
  }

  const textEncoder = new TextEncoder();
  const textDecoder = new TextDecoder();

  /* ====== 1. HASH ====== */
  async function hashMessage() {
    const input = document.getElementById('hashInput').value;
    const outputEl = document.getElementById('hashOutput');

    if (!input) {
      alert('Vui l√≤ng nh·∫≠p chu·ªói c·∫ßn bƒÉm.');
      return;
    }
    try {
      const data = textEncoder.encode(input);
      const digest = await crypto.subtle.digest('SHA-256', data);
      outputEl.textContent = bufferToHex(digest);
    } catch (err) {
      console.error(err);
      outputEl.textContent = 'L·ªói khi t√≠nh hash: ' + err.message;
    }
  }

  function clearHash() {
    document.getElementById('hashInput').value = '';
    document.getElementById('hashOutput').textContent = '‚Äî Ch∆∞a c√≥ k·∫øt qu·∫£ ‚Äî';
  }

  /* ====== 2. SYMMETRIC AES-GCM ====== */
  let symKey = null;
  let symIv = null;
  let symCiphertext = null;

  async function generateSymKey() {
    try {
      symKey = await crypto.subtle.generateKey(
        { name: 'AES-GCM', length: 256 },
        true,
        ['encrypt', 'decrypt']
      );
      const raw = await crypto.subtle.exportKey('raw', symKey);
      document.getElementById('symKey').textContent = bufferToBase64(raw);
      document.getElementById('symIv').textContent = '‚Äî S·∫Ω sinh khi b·∫°n m√£ h√≥a ‚Äî';
      document.getElementById('symCipher').textContent = '‚Äî Ch∆∞a c√≥ b·∫£n m√£ ‚Äî';
      document.getElementById('symDecrypted').textContent = '‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî';
    } catch (err) {
      console.error(err);
      alert('L·ªói sinh kh√≥a AES: ' + err.message);
    }
  }

  async function encryptSym() {
    if (!symKey) {
      alert('Ch∆∞a c√≥ kh√≥a ƒë·ªëi x·ª©ng. Vui l√≤ng b·∫•m ‚ÄúT·∫°o kh√≥a phi√™n‚Äù tr∆∞·ªõc.');
      return;
    }
    const plain = document.getElementById('symPlain').value;
    if (!plain) {
      alert('Vui l√≤ng nh·∫≠p b·∫£n r√µ c·∫ßn m√£ h√≥a.');
      return;
    }
    try {
      const data = textEncoder.encode(plain);
      symIv = crypto.getRandomValues(new Uint8Array(12)); // 96-bit IV
      const cipherBuf = await crypto.subtle.encrypt(
        { name: 'AES-GCM', iv: symIv },
        symKey,
        data
      );
      symCiphertext = cipherBuf;
      document.getElementById('symIv').textContent = bufferToBase64(symIv.buffer);
      document.getElementById('symCipher').textContent = bufferToBase64(cipherBuf);
      document.getElementById('symDecrypted').textContent = '‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî';
    } catch (err) {
      console.error(err);
      alert('L·ªói m√£ h√≥a AES: ' + err.message);
    }
  }

  async function decryptSym() {
    if (!symKey || !symCiphertext || !symIv) {
      alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ gi·∫£i m√£. H√£y th·ª±c hi·ªán m√£ h√≥a tr∆∞·ªõc.');
      return;
    }
    try {
      const plainBuf = await crypto.subtle.decrypt(
        { name: 'AES-GCM', iv: symIv },
        symKey,
        symCiphertext
      );
      const plain = textDecoder.decode(plainBuf);
      document.getElementById('symDecrypted').textContent = plain;
    } catch (err) {
      console.error(err);
      alert('Gi·∫£i m√£ th·∫•t b·∫°i: ' + err.message);
    }
  }

  /* ====== 3. ASYMMETRIC RSA-OAEP ====== */
  let rsaKeyPair = null;
  let rsaCipherBuf = null;

  async function generateRsaKeys() {
    try {
      rsaKeyPair = await crypto.subtle.generateKey(
        {
          name: 'RSA-OAEP',
          modulusLength: 2048,
          publicExponent: new Uint8Array([1, 0, 1]),
          hash: 'SHA-256',
        },
        true,
        ['encrypt', 'decrypt']
      );
      const spki = await crypto.subtle.exportKey('spki', rsaKeyPair.publicKey);
      const pkcs8 = await crypto.subtle.exportKey('pkcs8', rsaKeyPair.privateKey);
      const pub = bufferToBase64(spki);
      const priv = bufferToBase64(pkcs8);
      document.getElementById('rsaPublic').textContent = pub.slice(0, 140) + (pub.length > 140 ? '‚Ä¶' : '');
      document.getElementById('rsaPrivate').textContent = priv.slice(0, 140) + (priv.length > 140 ? '‚Ä¶' : '');
      document.getElementById('rsaCipher').textContent = '‚Äî Ch∆∞a c√≥ b·∫£n m√£ ‚Äî';
      document.getElementById('rsaDecrypted').textContent = '‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî';
    } catch (err) {
      console.error(err);
      alert('L·ªói sinh c·∫∑p kh√≥a RSA: ' + err.message);
    }
  }

  async function rsaEncrypt() {
    if (!rsaKeyPair) {
      alert('Ch∆∞a c√≥ c·∫∑p kh√≥a RSA. Vui l√≤ng b·∫•m ‚ÄúT·∫°o c·∫∑p kh√≥a RSA‚Äù tr∆∞·ªõc.');
      return;
    }
    const plain = document.getElementById('rsaPlain').value;
    if (!plain) {
      alert('Vui l√≤ng nh·∫≠p th√¥ng ƒëi·ªáp c·∫ßn m√£ h√≥a.');
      return;
    }
    try {
      const data = textEncoder.encode(plain);
      const cipherBuf = await crypto.subtle.encrypt(
        { name: 'RSA-OAEP' },
        rsaKeyPair.publicKey,
        data
      );
      rsaCipherBuf = cipherBuf;
      document.getElementById('rsaCipher').textContent = bufferToBase64(cipherBuf);
      document.getElementById('rsaDecrypted').textContent = '‚Äî Ch∆∞a gi·∫£i m√£ ‚Äî';
    } catch (err) {
      console.error(err);
      alert('L·ªói m√£ h√≥a RSA: ' + err.message);
    }
  }

  async function rsaDecrypt() {
    if (!rsaKeyPair || !rsaCipherBuf) {
      alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ gi·∫£i m√£. H√£y m√£ h√≥a tr∆∞·ªõc.');
      return;
    }
    try {
      const plainBuf = await crypto.subtle.decrypt(
        { name: 'RSA-OAEP' },
        rsaKeyPair.privateKey,
        rsaCipherBuf
      );
      const plain = textDecoder.decode(plainBuf);
      document.getElementById('rsaDecrypted').textContent = plain;
    } catch (err) {
      console.error(err);
      alert('Gi·∫£i m√£ RSA th·∫•t b·∫°i: ' + err.message);
    }
  }

  /* ====== 4. DIGITAL SIGNATURE RSA-PSS ====== */
  let signKeyPair = null;
  let lastSignature = null;

  async function generateSignKeys() {
    try {
      signKeyPair = await crypto.subtle.generateKey(
        {
          name: 'RSA-PSS',
          modulusLength: 2048,
          publicExponent: new Uint8Array([1, 0, 1]),
          hash: 'SHA-256',
        },
        true,
        ['sign', 'verify']
      );
      const spki = await crypto.subtle.exportKey('spki', signKeyPair.publicKey);
      const pkcs8 = await crypto.subtle.exportKey('pkcs8', signKeyPair.privateKey);
      const pub = bufferToBase64(spki);
      const priv = bufferToBase64(pkcs8);
      document.getElementById('sigPublic').textContent = pub.slice(0, 140) + (pub.length > 140 ? '‚Ä¶' : '');
      document.getElementById('sigPrivate').textContent = priv.slice(0, 140) + (priv.length > 140 ? '‚Ä¶' : '');
      document.getElementById('sigOutput').textContent = '‚Äî Ch∆∞a c√≥ ch·ªØ k√Ω ‚Äî';
      const statusEl = document.getElementById('sigStatus');
      statusEl.textContent = '‚Äî Ch∆∞a ki·ªÉm tra ‚Äî';
      statusEl.className = 'status';
    } catch (err) {
      console.error(err);
      alert('L·ªói sinh c·∫∑p kh√≥a ch·ªØ k√Ω s·ªë: ' + err.message);
    }
  }

  async function signMessage() {
    if (!signKeyPair) {
      alert('Ch∆∞a c√≥ c·∫∑p kh√≥a ch·ªØ k√Ω. Vui l√≤ng b·∫•m ‚ÄúT·∫°o c·∫∑p kh√≥a ch·ªØ k√Ω‚Äù.');
      return;
    }
    const msg = document.getElementById('sigInput').value;
    if (!msg) {
      alert('Vui l√≤ng nh·∫≠p th√¥ng ƒëi·ªáp c·∫ßn k√Ω.');
      return;
    }
    try {
      const data = textEncoder.encode(msg);
      const signature = await crypto.subtle.sign(
        { name: 'RSA-PSS', saltLength: 32 },
        signKeyPair.privateKey,
        data
      );
      lastSignature = signature;
      const b64 = bufferToBase64(signature);
      document.getElementById('sigOutput').textContent = b64;
      const statusEl = document.getElementById('sigStatus');
      statusEl.textContent = 'Ch∆∞a ki·ªÉm tra ch·ªØ k√Ω ‚Äì h√£y b·∫•m ‚ÄúKi·ªÉm tra ch·ªØ k√Ω‚Äù.';
      statusEl.className = 'status';
    } catch (err) {
      console.error(err);
      alert('L·ªói k√Ω: ' + err.message);
    }
  }

  async function verifySignature() {
    if (!signKeyPair) {
      alert('Ch∆∞a c√≥ c·∫∑p kh√≥a ch·ªØ k√Ω.');
      return;
    }
    const statusEl = document.getElementById('sigStatus');
    const msg = document.getElementById('sigInput').value;
    const sigB64 = document.getElementById('sigOutput').textContent.trim();
    if (!msg || !sigB64 || sigB64.startsWith('‚Äî')) {
      alert('C·∫ßn c·∫£ th√¥ng ƒëi·ªáp v√† ch·ªØ k√Ω ƒë·ªÉ ki·ªÉm tra.');
      return;
    }
    try {
      const data = textEncoder.encode(msg);
      const signature = base64ToBuffer(sigB64);
      const ok = await crypto.subtle.verify(
        { name: 'RSA-PSS', saltLength: 32 },
        signKeyPair.publicKey,
        signature,
        data
      );
      if (ok) {
        statusEl.textContent = '‚úÖ Ch·ªØ k√Ω h·ª£p l·ªá (ƒë√∫ng kh√≥a c√¥ng khai & ƒë√∫ng n·ªôi dung).';
        statusEl.className = 'status ok';
      } else {
        statusEl.textContent = '‚ùå Ch·ªØ k√Ω KH√îNG h·ª£p l·ªá (n·ªôi dung ƒë√£ thay ƒë·ªïi ho·∫∑c sai kh√≥a).';
        statusEl.className = 'status error';
      }
    } catch (err) {
      console.error(err);
      statusEl.textContent = 'L·ªói khi ki·ªÉm tra ch·ªØ k√Ω: ' + err.message;
      statusEl.className = 'status error';
    }
  }

  /* ====== 5. AUTH + BIOMETRICS (FAKE DEMO) ====== */
  let biometricOk = false;

  function fakeBiometric(type) {
    biometricOk = true;
    const statusEl = document.getElementById('authStatus');
    if (type === 'finger') {
      statusEl.textContent = '‚úÖ V√¢n tay (demo) ƒë√£ ƒë∆∞·ª£c ‚Äúch·∫•p nh·∫≠n‚Äù.';
    } else {
      statusEl.textContent = '‚úÖ Khu√¥n m·∫∑t (demo) ƒë√£ ƒë∆∞·ª£c ‚Äúch·∫•p nh·∫≠n‚Äù.';
    }
    statusEl.className = 'status ok';
  }

  function attemptLogin() {
    const user = document.getElementById('authUser').value.trim();
    const pass = document.getElementById('authPass').value.trim();
    const otp = document.getElementById('authOtp').value.trim();
    const statusEl = document.getElementById('authStatus');

    const correctPass = '123456';
    const correctOtp = '000999';

    if (!user || !pass || !otp) {
      alert('Vui l√≤ng nh·∫≠p ƒë·ªß t√†i kho·∫£n, m·∫≠t kh·∫©u v√† OTP.');
      return;
    }

    if (pass !== correctPass || otp !== correctOtp) {
      statusEl.textContent = '‚ùå Sai m·∫≠t kh·∫©u ho·∫∑c OTP (demo).';
      statusEl.className = 'status error';
      return;
    }

    if (!biometricOk) {
      statusEl.textContent = '‚ö†Ô∏è M·∫≠t kh·∫©u & OTP ƒë√∫ng, nh∆∞ng ch∆∞a th·ª±c hi·ªán sinh tr·∫Øc (demo).';
      statusEl.className = 'status error';
      return;
    }

    statusEl.textContent = '‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng (demo): ƒë·ªß 3 y·∫øu t·ªë.';
    statusEl.className = 'status ok';
  }

  function resetAuth() {
    document.getElementById('authUser').value = '';
    document.getElementById('authPass').value = '';
    document.getElementById('authOtp').value = '';
    biometricOk = false;
    const statusEl = document.getElementById('authStatus');
    statusEl.textContent = '‚Äî Ch∆∞a ƒëƒÉng nh·∫≠p ‚Äî';
    statusEl.className = 'status';
  }

  /* ====== 6. BLOCKCHAIN MINI-DEMO ====== */
  let blockchain = [];

  async function computeHash(prevHash, timestamp, data) {
    const input = prevHash + '|' + timestamp + '|' + data;
    const digest = await crypto.subtle.digest('SHA-256', textEncoder.encode(input));
    return bufferToHex(digest);
  }

  async function addBlock() {
    const dataInput = document.getElementById('blockData').value.trim();
    const data = dataInput || `Demo block #${blockchain.length}`;
    const index = blockchain.length;
    const timestamp = new Date().toISOString();
    const prevHash = index === 0 ? 'GENESIS' : blockchain[index - 1].hash;
    const hash = await computeHash(prevHash, timestamp, data);
    blockchain.push({ index, timestamp, data, prevHash, hash });
    document.getElementById('blockData').value = '';
    renderChain();
  }

  function renderChain() {
    const container = document.getElementById('chainView');
    container.innerHTML = '';
    for (let i = 0; i < blockchain.length; i++) {
      const block = blockchain[i];
      const isValidPrev =
        i === 0 ? block.prevHash === 'GENESIS'
                : block.prevHash === blockchain[i - 1].hash;
      const blockEl = document.createElement('div');
      blockEl.className = 'block' + (isValidPrev ? '' : ' invalid');
      blockEl.innerHTML = `
        <div class="block-header-row">
          <span class="block-index">Block #${block.index}</span>
          <span class="chip">${isValidPrev ? 'OK' : 'BROKEN'}</span>
        </div>
        <div><b>time</b>: ${block.timestamp}</div>
        <div><b>data</b>: ${escapeHtml(block.data)}</div>
        <div><b>prevHash</b>: ${block.prevHash}</div>
        <div><b>hash</b>: ${block.hash}</div>
      `;
      container.appendChild(blockEl);
    }
    if (blockchain.length === 0) {
      container.textContent = '‚Äî Ch∆∞a c√≥ block n√†o. H√£y b·∫•m ‚ÄúTh√™m block v√†o chain‚Äù. ‚Äî';
    }
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  async function tamperBlock() {
    if (blockchain.length < 2) {
      alert('C·∫ßn √≠t nh·∫•t 2 block ƒë·ªÉ demo gi·∫£ m·∫°o (block #0 v√† block #1).');
      return;
    }
    blockchain[1].data = blockchain[1].data + ' [ƒê√É B·ªä GI·∫¢ M·∫†O]';
    const b1 = blockchain[1];
    computeHash(b1.prevHash, b1.timestamp, b1.data).then(newHash => {
      b1.hash = newHash;
      renderChain();
      alert('ƒê√£ gi·∫£ m·∫°o d·ªØ li·ªáu block #1. H√£y xem tr·∫°ng th√°i chu·ªói (block sau b·ªã BROKEN).');
    });
  }

  function resetChain() {
    blockchain = [];
    renderChain();
  }

  // ====== NAV ACTIVE v·ªõi IntersectionObserver ======
  const sectionToNavId = {
    'hash-card': 'nav-hash',
    'sym-card': 'nav-sym',
    'asym-card': 'nav-asym',
    'sig-card': 'nav-sig',
    'auth-card': 'nav-auth',
    'bc-card': 'nav-bc'
  };

  function setActiveNav(sectionId) {
    const navButtons = document.querySelectorAll('.nav-btn');
    navButtons.forEach(btn => btn.classList.remove('active'));
    const navId = sectionToNavId[sectionId];
    if (!navId) return;
    const activeBtn = document.getElementById(navId);
    if (activeBtn) activeBtn.classList.add('active');
  }

  // T·∫°o observer
  const observerOptions = {
    root: null,
    threshold: 0.4
  };

  const observerCallback = (entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        setActiveNav(entry.target.id);
      }
    });
  };

  const sectionObserver = new IntersectionObserver(observerCallback, observerOptions);
  Object.keys(sectionToNavId).forEach(sectionId => {
    const section = document.getElementById(sectionId);
    if (section) sectionObserver.observe(section);
  });

  // Kh·ªüi t·∫°o chain r·ªóng
  renderChain();
</script>
</body>
</html>
